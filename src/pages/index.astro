---
import Layout from '@layouts/Layout.astro';
import Header from "@components/Header.astro";
import {getImageUrl} from "@services/cloud/cloud";
import {type ExperienceAsset} from "../types/Asset";
import ExperienceCarousel from "@components/ExperienceCarousel.astro";
import MainMetadata from "@components/MainMetadata.astro";
import {getLangFromUrl, getLocaleUrlRelative, useTranslations} from "@i18n/utils";
import {getCollection} from 'astro:content'

const lang = getLangFromUrl(Astro.url)
const translations = useTranslations(lang)
const assets2 = await getCollection('experience')
const langRegEx = new RegExp(lang)
const assets = assets2
    .filter(({id}) => langRegEx.test(id))
    .map((asset): ExperienceAsset => {
        const job = asset.data

        return {
            classNames: 'job',
            href: getLocaleUrlRelative(lang, job.href),
            transitionName: job.transitionName,
            title: job.roles.join(' && '),
            company: job.company,
            description: job.description,
            startYear: job.startYear,
        }
    })
const carouselParams = {
    title: translations('experience.carousel.title'),
    history: 'auto'
}
const backgroundSrc = getImageUrl('frank_grayscale.webp').toString()
const canonicalUrl = Astro.url.href
---

<Layout
        title={translations('meta.title')}
        description={translations('meta.description')}
        bgSrc={backgroundSrc}
        bgTitle={translations('main.background.alt')}
        canonicalURL={canonicalUrl}>
    <Header classNames="hidden">
        <h2>Frank<br/>Roma√±a</h2>
    </Header>
    <main>
        <MainMetadata></MainMetadata>
        <ExperienceCarousel assets={assets} params={carouselParams}/>
    </main>
</Layout>
